<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Layered Chat Interface</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script>
  tailwind.config = {
    darkMode: "class",
    theme: {
      extend: {
        colors: {
          primary: "#3B82F6",
          "background-light": "#F8FAFC",
          "background-dark": "#0F172A",
        },
        fontFamily: {
          display: ["Arial", "sans-serif"],
        },
        borderRadius: {
          DEFAULT: "0.75rem",
        },
      },
    },
  };
</script>
<style type="text/tailwindcss">
  body { font-family: 'Inter', sans-serif; }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
  .dark ::-webkit-scrollbar-thumb { background: #334155; }
  .material-symbols-outlined {
    font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
  }
  
  /* Mobile-specific styles - ONLY affects mobile, desktop unchanged */
  @media (max-width: 768px) {
    /* Navigation is ALWAYS visible on mobile */
    nav {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
    }
    
    /* Chat list - positioned after nav, full width minus nav */
    #chatListLayer {
      position: fixed !important;
      left: 80px !important;
      right: 0 !important;
      top: 0 !important;
      bottom: 0 !important;
      width: auto !important;
      max-width: none !important;
      z-index: 30;
      transform: translateX(0) !important;
    }
    
    /* COMPLETELY hide chat list when viewing messages */
    body.mobile-chat-open #chatListLayer {
      transform: translateX(-200%) !important;
      visibility: hidden;
    }
    
    /* Chat view - positioned after nav, hidden by default */
    #chatViewLayer {
      position: fixed !important;
      left: 80px !important;
      right: 0 !important;
      top: 0 !important;
      bottom: 0 !important;
      width: auto !important;
      z-index: 40;
      transform: translateX(100%) !important;
    }
    
    /* Show chat view when mobile-chat-open */
    body.mobile-chat-open #chatViewLayer {
      transform: translateX(0) !important;
      left: 80px !important;
    }
    
    /* Profile panel - full screen overlay, hidden by default */
    #profileLayer {
      position: fixed !important;
      left: 80px !important;
      right: 0 !important;
      top: 0 !important;
      bottom: 0 !important;
      width: auto !important;
      z-index: 50;
      transform: translateX(100%) !important;
    }
    
    /* Show profile when mobile-profile-open */
    body.mobile-profile-open #profileLayer {
      transform: translateX(0) !important;
    }
    
    /* Fix message input area on mobile - ensure buttons are visible */
    #chatViewLayer .bg-white.dark\:bg-slate-900.border-t {
      padding-left: 0.75rem !important;
      padding-right: 0.75rem !important;
    }
    
    #chatViewLayer .flex.items-center.gap-2 {
      gap: 0.25rem !important;
    }
    
    #messageInput {
      font-size: 13px !important;
      padding: 0.5rem 0.75rem !important;
      min-width: 0 !important;
    }
    
    #sendButton, #emojiButton, #attachButton {
      flex-shrink: 0 !important;
      padding: 0.5rem !important;
    }
    
    #sendButton .material-symbols-outlined,
    #emojiButton .material-symbols-outlined,
    #attachButton .material-symbols-outlined {
      font-size: 20px !important;
    }
  }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 h-screen flex overflow-hidden transition-colors duration-200">

<!-- Left Sidebar Navigation -->
<nav class="w-20 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col items-center py-6 shrink-0 z-20">
  <div class="bg-primary p-2 rounded-xl text-white mb-10 shadow-lg shadow-blue-500/20">
    <span class="material-symbols-outlined text-2xl block">school</span>
  </div>
  <div class="flex flex-col gap-8 flex-1">
    <button id="navHome" class="p-3 rounded-xl text-slate-400 hover:text-primary hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center group relative">
      <span class="material-symbols-outlined">home</span>
      <span class="absolute left-full ml-4 px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">Home</span>
    </button>
    <button id="navDMs" class="p-3 rounded-xl bg-blue-50 dark:bg-blue-900/30 text-primary flex items-center justify-center group relative">
      <span class="material-symbols-outlined">chat_bubble</span>
      <span class="absolute left-full ml-4 px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">DMs</span>
    </button>
    <button id="navExplore" class="p-3 rounded-xl text-slate-400 hover:text-primary hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center group relative">
      <span class="material-symbols-outlined">explore</span>
      <span class="absolute left-full ml-4 px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">Explore</span>
    </button>
    <button id="navProfile" class="p-3 rounded-xl text-slate-400 hover:text-primary hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center group relative">
      <span class="material-symbols-outlined">person</span>
      <span class="absolute left-full ml-4 px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50">Profile</span>
    </button>
  </div>
  <div class="flex flex-col gap-6 items-center">
    <button id="darkModeToggle" class="p-3 text-slate-400 hover:text-primary transition-colors">
      <span class="material-symbols-outlined">dark_mode</span>
    </button>
    <div class="h-10 w-10 rounded-full bg-slate-200 dark:bg-slate-700 p-0.5 border border-slate-200 dark:border-slate-800">
      <img alt="Alex Johnson Profile" class="h-full w-full rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk"/>
    </div>
  </div>
</nav>

<!-- LAYER 1: Chat List -->
<div id="chatListLayer" class="flex-1 flex flex-col bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 transform transition-transform duration-300 translate-x-0">
  <div class="p-6">
    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Messages</p>
    <h2 class="text-2xl font-bold mb-6"><span id="unreadCount">06</span> Unread</h2>
    <div class="relative">
      <span class="material-symbols-outlined absolute left-3 top-2.5 text-slate-400 text-sm">search</span>
      <input id="searchInput" class="w-full bg-slate-100 dark:bg-slate-800/50 border-none rounded-xl py-2.5 pl-10 pr-4 text-sm placeholder-slate-400 focus:ring-2 focus:ring-primary/20 transition-all" placeholder="Search chats..." type="text"/>
    </div>
  </div>
  
  <div class="flex-1 overflow-y-auto px-3 py-4">
    <div class="flex items-center justify-between px-3 mb-4 relative">
      <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Recent Chats</span>
      <button id="chatOptionsButton" class="text-slate-400 hover:text-primary transition-colors"><span class="material-symbols-outlined text-sm">more_horiz</span></button>
      
      <!-- Chat Options Dropdown Menu -->
      <div id="chatOptionsMenu" class="hidden absolute right-0 top-full mt-2 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 py-2 w-48 z-50">
        <button id="newChatBtn" class="w-full px-4 py-2.5 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-primary text-lg">add_circle</span>
          <span>New Chat</span>
        </button>
        <button id="markAllReadBtn" class="w-full px-4 py-2.5 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-primary text-lg">done_all</span>
          <span>Mark All as Read</span>
        </button>
        <div class="h-px bg-slate-200 dark:bg-slate-700 my-1"></div>
        <button id="settingsBtn" class="w-full px-4 py-2.5 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-primary text-lg">settings</span>
          <span>Settings</span>
        </button>
      </div>
    </div>
    <div id="chatList"></div>
  </div>
</div>

<!-- Context Menu for Chat Items -->
<div id="chatContextMenu" class="hidden fixed bg-white dark:bg-slate-800 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 py-2 w-56 z-[60]">
  <button id="contextMarkUnread" class="w-full px-4 py-2.5 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
    <span class="material-symbols-outlined text-blue-600 text-lg">mark_email_unread</span>
    <span>Mark as Unread</span>
  </button>
  <button id="contextPinChat" class="w-full px-4 py-2.5 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
    <span class="material-symbols-outlined text-blue-600 text-lg">push_pin</span>
    <span>Pin Chat</span>
  </button>
  <button id="contextArchive" class="w-full px-4 py-2.5 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
    <span class="material-symbols-outlined text-blue-600 text-lg">archive</span>
    <span>Archive Chat</span>
  </button>
  <div class="h-px bg-slate-200 dark:bg-slate-700 my-1"></div>
  <button id="contextClearChat" class="w-full px-4 py-2.5 text-left hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors flex items-center gap-3 text-sm text-red-600">
    <span class="material-symbols-outlined text-lg">delete_sweep</span>
    <span>Clear Chat</span>
  </button>
  <button id="contextDeleteChat" class="w-full px-4 py-2.5 text-left hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors flex items-center gap-3 text-sm text-red-600">
    <span class="material-symbols-outlined text-lg">delete</span>
    <span>Delete Chat</span>
  </button>
</div>

<!-- LAYER 2: Chat View -->
<div id="chatViewLayer" class="flex flex-col bg-background-light dark:bg-background-dark absolute inset-0 left-20 transform transition-transform duration-300 translate-x-full">
  <!-- Chat Header -->
  <div class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-6 py-3 flex items-center justify-between shrink-0">
    <div class="flex items-center gap-3">
      <button id="backToChatList" class="p-2 -ml-2 text-slate-400 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">arrow_back</span>
      </button>
      <div class="relative">
        <img id="activeChatAvatar" alt="" class="h-10 w-10 rounded-full" src=""/>
        <div id="activeChatStatus" class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 rounded-full border-2 border-white dark:border-slate-900"></div>
      </div>
      <div>
        <h3 id="activeChatName" class="font-semibold text-sm leading-none mb-1"></h3>
        <p id="activeChatRole" class="text-xs text-slate-400"></p>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button class="p-2 text-slate-400 hover:text-primary hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition-all">
        <span class="material-symbols-outlined">videocam</span>
      </button>
      <button class="p-2 text-slate-400 hover:text-primary hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition-all">
        <span class="material-symbols-outlined">call</span>
      </button>
      <button id="infoButton" class="p-2 text-slate-400 hover:text-primary hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition-all">
        <span class="material-symbols-outlined">info</span>
      </button>
    </div>
  </div>

  <!-- Messages Container -->
  <div id="messagesContainer" class="flex-1 overflow-y-auto px-6 py-6 space-y-4"></div>

  <!-- Input Area -->
  <div class="bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 px-6 py-4 shrink-0">
    <div class="flex items-center gap-2">
      <button id="attachButton" class="p-2 text-slate-400 hover:text-primary transition-all relative">
        <span class="material-symbols-outlined text-2xl">add_circle</span>
      </button>
      
      <!-- Attachment Menu (separate from button) -->
      <div id="attachMenu" class="hidden absolute bottom-20 left-6 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 py-2 w-56 z-50">
        <button class="attach-option w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-blue-600">photo_library</span>
          <span>Photo & Video Library</span>
        </button>
        <button class="attach-option w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-blue-600">photo_camera</span>
          <span>Camera</span>
        </button>
        <button class="attach-option w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-blue-600">insert_drive_file</span>
          <span>Document</span>
        </button>
        <button class="attach-option w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-blue-600">mic</span>
          <span>Audio</span>
        </button>
        <button class="attach-option w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-blue-600">location_on</span>
          <span>Location</span>
        </button>
        <button class="attach-option w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors flex items-center gap-3 text-sm">
          <span class="material-symbols-outlined text-blue-600">person</span>
          <span>Contact</span>
        </button>
      </div>
      
      <input id="messageInput" class="flex-1 bg-slate-100 dark:bg-slate-800/50 border-none rounded-full py-3 px-5 text-sm placeholder-slate-400 focus:ring-2 focus:ring-primary/20 transition-all" placeholder="Type a message..."/>
      
      <button id="emojiButton" class="p-2 text-slate-400 hover:text-primary transition-all relative">
        <span class="material-symbols-outlined text-2xl">sentiment_satisfied</span>
        <!-- Emoji Picker -->
        <div id="emojiPicker" class="hidden absolute bottom-full right-0 mb-2 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 p-3 w-64 z-50">
          <div id="emojiGrid" class="grid grid-cols-8 gap-1 max-h-48 overflow-y-auto"></div>
        </div>
      </button>
      
      <button id="sendButton" class="p-3 bg-primary text-white rounded-full hover:bg-blue-600 transition-all shadow-lg shadow-blue-500/20">
        <span class="material-symbols-outlined">send</span>
      </button>
    </div>
  </div>
</div>

<!-- LAYER 3: Profile Panel (slides in from right, alongside chat) -->
<div id="profileLayer" class="w-96 flex flex-col bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-800 absolute top-0 bottom-0 right-0 transform transition-transform duration-300 translate-x-full z-10">
  <div class="p-6 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between">
    <button id="backToChat" class="p-2 -ml-2 text-slate-400 hover:text-primary transition-colors">
      <span class="material-symbols-outlined">arrow_back</span>
    </button>
    <h3 class="font-semibold">Contact Info</h3>
    <button id="closeProfile" class="p-2 -mr-2 text-slate-400 hover:text-primary transition-colors">
      <span class="material-symbols-outlined">close</span>
    </button>
  </div>
  <div class="flex-1 overflow-y-auto">
    <div class="p-6 text-center border-b border-slate-200 dark:border-slate-800">
      <div class="relative inline-block mb-4">
        <img id="profileAvatar" alt="" class="h-24 w-24 rounded-full mx-auto" src=""/>
        <div id="profileStatus" class="absolute bottom-2 right-2 h-5 w-5 bg-green-500 rounded-full border-4 border-white dark:border-slate-900"></div>
      </div>
      <h2 id="profileName" class="text-xl font-bold mb-1"></h2>
      <p id="profileRole" class="text-sm text-slate-400 mb-4"></p>
      <div class="flex gap-2 justify-center">
        <button class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
          <span class="material-symbols-outlined text-primary">call</span>
        </button>
        <button class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
          <span class="material-symbols-outlined text-primary">videocam</span>
        </button>
        <button class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
          <span class="material-symbols-outlined text-primary">mail</span>
        </button>
      </div>
    </div>
    <div class="p-6 space-y-6">
      <div>
        <p class="text-xs text-slate-400 uppercase tracking-wider mb-3">About</p>
        <p id="profileBio" class="text-sm"></p>
      </div>
      
      <div>
        <div class="flex items-center justify-between mb-3">
          <p class="text-xs text-slate-400 uppercase tracking-wider">Media, Links, and Docs</p>
          <button class="text-xs text-primary hover:underline">See all</button>
        </div>
        <div class="grid grid-cols-3 gap-2">
          <div class="aspect-square bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg"></div>
          <div class="aspect-square bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg"></div>
          <div class="aspect-square bg-gradient-to-br from-pink-400 to-pink-600 rounded-lg"></div>
        </div>
      </div>

      <div class="border-t border-slate-200 dark:border-slate-800 pt-4">
        <button class="w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition-colors flex items-center gap-3">
          <span class="material-symbols-outlined text-slate-600 dark:text-slate-400">notifications</span>
          <span class="text-sm">Mute notifications</span>
        </button>
        <button class="w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition-colors flex items-center gap-3">
          <span class="material-symbols-outlined text-slate-600 dark:text-slate-400">wallpaper</span>
          <span class="text-sm">Wallpaper</span>
        </button>
        <button class="w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition-colors flex items-center gap-3">
          <span class="material-symbols-outlined text-slate-600 dark:text-slate-400">lock</span>
          <span class="text-sm">Encryption</span>
        </button>
      </div>

      <div class="border-t border-slate-200 dark:border-slate-800 pt-4">
        <button class="w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors flex items-center gap-3 text-red-600">
          <span class="material-symbols-outlined">block</span>
          <span class="text-sm">Block Contact</span>
        </button>
        <button class="w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors flex items-center gap-3 text-red-600">
          <span class="material-symbols-outlined">flag</span>
          <span class="text-sm">Report Contact</span>
        </button>
        <button class="w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors flex items-center gap-3 text-red-600">
          <span class="material-symbols-outlined">delete</span>
          <span class="text-sm">Delete Chat</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Check if mobile device
function isMobile() {
  return window.innerWidth < 768;
}

// Dark mode toggle
const darkModeToggle = document.getElementById('darkModeToggle');
darkModeToggle.addEventListener('click', () => {
  document.documentElement.classList.toggle('dark');
});

// Sample data
let allChats = [
  {
    id: 1,
    name: "Sarah Miller",
    role: "Product Manager",
    avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk",
    lastMessage: "Perfect! Let's schedule a call for tomorrow",
    time: "2m ago",
    unread: 2,
    online: true,
    bio: "Product Manager at TechCorp. Love building products that solve real problems.",
    messages: [
      { id: 1, sender: "them", text: "Hey! Did you get a chance to review the proposal?", time: "10:30 AM" },
      { id: 2, sender: "me", text: "Yes, I went through it. Looks great overall!", time: "10:32 AM" },
      { id: 3, sender: "them", text: "Perfect! Let's schedule a call for tomorrow", time: "10:35 AM" }
    ]
  },
  {
    id: 2,
    name: "Marcus Chen",
    role: "UX Designer",
    avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk",
    lastMessage: "The new mockups are ready for review",
    time: "1h ago",
    unread: 1,
    online: true,
    bio: "Designing delightful experiences. Coffee enthusiast â˜•",
    messages: [
      { id: 1, sender: "them", text: "The new mockups are ready for review", time: "Yesterday" },
      { id: 2, sender: "me", text: "Great, I'll check them out today", time: "Yesterday" }
    ]
  },
  {
    id: 3,
    name: "Emily Rodriguez",
    role: "Software Engineer",
    avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk",
    lastMessage: "Thanks! The bug fix works perfectly now",
    time: "3h ago",
    unread: 0,
    online: false,
    bio: "Full-stack developer. Building the future, one line of code at a time.",
    messages: [
      { id: 1, sender: "me", text: "Fixed that issue you mentioned", time: "3h ago" },
      { id: 2, sender: "them", text: "Thanks! The bug fix works perfectly now", time: "3h ago" }
    ]
  },
  {
    id: 4,
    name: "David Park",
    role: "Marketing Lead",
    avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk",
    lastMessage: "Campaign performance is looking great!",
    time: "5h ago",
    unread: 1,
    online: true,
    bio: "Marketing strategist. Data-driven growth hacker.",
    messages: [
      { id: 1, sender: "them", text: "Campaign performance is looking great!", time: "5h ago" }
    ]
  },
  {
    id: 5,
    name: "Lisa Thompson",
    role: "HR Manager",
    avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk",
    lastMessage: "Your performance review is scheduled",
    time: "Yesterday",
    unread: 2,
    online: false,
    bio: "People operations. Building great teams and culture.",
    messages: [
      { id: 1, sender: "them", text: "Your performance review is scheduled", time: "Yesterday" }
    ]
  },
  {
    id: 6,
    name: "James Wilson",
    role: "Sales Director",
    avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk",
    lastMessage: "Closed 3 deals this week! ðŸŽ‰",
    time: "Yesterday",
    unread: 0,
    online: true,
    bio: "Sales leader. Closing deals and building relationships.",
    messages: [
      { id: 1, sender: "them", text: "Closed 3 deals this week! ðŸŽ‰", time: "Yesterday" }
    ]
  }
];

let filteredChats = [...allChats];
let activeChat = allChats[0];
let navigationStack = [];

// Layer management with mobile detection
function showChatList() {
  if (isMobile()) {
    document.body.classList.remove('mobile-chat-open', 'mobile-profile-open');
  } else {
    document.getElementById('chatListLayer').style.transform = 'translateX(0)';
    document.getElementById('chatViewLayer').style.transform = 'translateX(100%)';
    document.getElementById('profileLayer').style.transform = 'translateX(100%)';
  }
}

function showChatView() {
  if (isMobile()) {
    document.body.classList.add('mobile-chat-open');
    document.body.classList.remove('mobile-profile-open');
  } else {
    document.getElementById('chatListLayer').style.transform = 'translateX(0)';
    document.getElementById('chatViewLayer').style.transform = 'translateX(0)';
    document.getElementById('profileLayer').style.transform = 'translateX(100%)';
  }
}

function showProfile() {
  if (isMobile()) {
    document.body.classList.add('mobile-chat-open', 'mobile-profile-open');
  } else {
    document.getElementById('chatListLayer').style.transform = 'translateX(0)';
    document.getElementById('chatViewLayer').style.transform = 'translateX(0)';
    document.getElementById('profileLayer').style.transform = 'translateX(0)';
  }
}

function closeProfile() {
  if (isMobile()) {
    document.body.classList.remove('mobile-profile-open');
  } else {
    document.getElementById('profileLayer').style.transform = 'translateX(100%)';
  }
}

// Render functions
function renderChatList() {
  const chatListContainer = document.getElementById('chatList');
  chatListContainer.innerHTML = filteredChats.map(chat => `
    <div class="chat-item p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 cursor-pointer transition-all mb-2 ${activeChat.id === chat.id ? 'bg-blue-50 dark:bg-blue-900/30' : ''}" data-chat-id="${chat.id}">
      <div class="flex items-start gap-3">
        <div class="relative shrink-0">
          <img alt="${chat.name}" class="h-12 w-12 rounded-full object-cover" src="${chat.avatar}"/>
          ${chat.online ? '<div class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 rounded-full border-2 border-white dark:border-slate-900"></div>' : ''}
        </div>
        <div class="flex-1 min-w-0">
          <div class="flex items-start justify-between mb-1">
            <h4 class="font-semibold text-sm truncate pr-2">${chat.name}</h4>
            <span class="text-[10px] text-slate-400 shrink-0">${chat.time}</span>
          </div>
          <p class="text-xs text-slate-500 dark:text-slate-400 truncate mb-1">${chat.role}</p>
          <p class="text-xs ${chat.unread > 0 ? 'text-slate-900 dark:text-slate-100 font-medium' : 'text-slate-400'} truncate">${chat.lastMessage}</p>
        </div>
        ${chat.unread > 0 ? `<div class="shrink-0 mt-1"><div class="bg-primary text-white text-[10px] font-bold rounded-full h-5 w-5 flex items-center justify-center">${chat.unread}</div></div>` : ''}
      </div>
    </div>
  `).join('');

  document.querySelectorAll('.chat-item').forEach(item => {
    const chatId = parseInt(item.dataset.chatId);
    
    item.addEventListener('click', () => {
      const chat = allChats.find(c => c.id === chatId);
      if (chat) {
        activeChat = chat;
        chat.unread = 0;
        renderChatList();
        renderActiveChat();
        renderMessages();
        updateUnreadCount();
        showChatView();
        pushNavigationState('chat-view');
      }
    });

    item.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      showContextMenu(e.clientX, e.clientY, chatId);
    });
  });
}

function renderActiveChat() {
  document.getElementById('activeChatAvatar').src = activeChat.avatar;
  document.getElementById('activeChatName').textContent = activeChat.name;
  document.getElementById('activeChatRole').textContent = activeChat.role;
  document.getElementById('activeChatStatus').className = `absolute bottom-0 right-0 h-3 w-3 ${activeChat.online ? 'bg-green-500' : 'bg-slate-400'} rounded-full border-2 border-white dark:border-slate-900`;
  
  document.getElementById('profileAvatar').src = activeChat.avatar;
  document.getElementById('profileName').textContent = activeChat.name;
  document.getElementById('profileRole').textContent = activeChat.role;
  document.getElementById('profileBio').textContent = activeChat.bio;
  document.getElementById('profileStatus').className = `absolute bottom-1 right-1 h-5 w-5 ${activeChat.online ? 'bg-green-500' : 'bg-slate-400'} rounded-full border-4 border-white dark:border-slate-900`;
}

function renderMessages() {
  const container = document.getElementById('messagesContainer');
  container.innerHTML = activeChat.messages.map(msg => {
    const isMe = msg.sender === 'me';
    return `
      <div class="flex ${isMe ? 'justify-end' : 'justify-start'}">
        <div class="${isMe ? 'bg-primary text-white' : 'bg-white dark:bg-slate-800'} rounded-2xl px-4 py-2.5 max-w-[70%] shadow-sm">
          <p class="text-sm">${msg.text}</p>
          <span class="text-[10px] ${isMe ? 'text-blue-100' : 'text-slate-400'} mt-1 block">${msg.time}</span>
        </div>
      </div>
    `;
  }).join('');
  
  container.scrollTop = container.scrollHeight;
}

function updateUnreadCount() {
  const total = allChats.reduce((sum, chat) => sum + chat.unread, 0);
  document.getElementById('unreadCount').textContent = total.toString().padStart(2, '0');
}

// Search functionality
document.getElementById('searchInput').addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase();
  filteredChats = allChats.filter(chat => 
    chat.name.toLowerCase().includes(query) || 
    chat.lastMessage.toLowerCase().includes(query)
  );
  renderChatList();
});

// Message sending
const messageInput = document.getElementById('messageInput');
const sendButton = document.getElementById('sendButton');

function sendMessage() {
  const text = messageInput.value.trim();
  if (text) {
    const newMessage = {
      id: activeChat.messages.length + 1,
      sender: 'me',
      text: text,
      time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })
    };
    activeChat.messages.push(newMessage);
    activeChat.lastMessage = text;
    activeChat.time = 'Just now';
    
    messageInput.value = '';
    renderMessages();
    renderChatList();
  }
}

sendButton.addEventListener('click', sendMessage);
messageInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// Emoji picker
const emojiButton = document.getElementById('emojiButton');
const emojiPicker = document.getElementById('emojiPicker');
const emojiGrid = document.getElementById('emojiGrid');

// Attachment menu
const attachButton = document.getElementById('attachButton');
const attachMenu = document.getElementById('attachMenu');

attachButton.addEventListener('click', (e) => {
  e.stopPropagation();
  attachMenu.classList.toggle('hidden');
  emojiPicker.classList.add('hidden');
  document.getElementById('chatOptionsMenu').classList.add('hidden');
});

attachMenu.addEventListener('click', (e) => e.stopPropagation());

// Handle attachment options
document.querySelectorAll('.attach-option').forEach(btn => {
  btn.addEventListener('click', () => {
    const optionText = btn.textContent.trim();
    console.log(`Selected: ${optionText}`);
    // You can add file input handling here
    alert(`${optionText} selected - file upload would happen here`);
    attachMenu.classList.add('hidden');
  });
});

// Common emojis
const emojis = ['ðŸ˜Š', 'ðŸ˜‚', 'â¤ï¸', 'ðŸ‘', 'ðŸŽ‰', 'ðŸ”¥', 'âœ¨', 'ðŸ’¯', 'ðŸ™Œ', 'ðŸ‘', 'ðŸ˜', 'ðŸ¤”', 'ðŸ˜…', 'ðŸ¥³', 'ðŸ’ª', 'ðŸŒŸ'];
emojis.forEach(emoji => {
  const btn = document.createElement('button');
  btn.textContent = emoji;
  btn.className = 'text-xl hover:bg-slate-100 dark:hover:bg-slate-700 rounded p-1 transition-colors';
  btn.onclick = () => {
    messageInput.value += emoji;
    messageInput.focus();
  };
  emojiGrid.appendChild(btn);
});

emojiButton.addEventListener('click', (e) => {
  e.stopPropagation();
  emojiPicker.classList.toggle('hidden');
  document.getElementById('chatOptionsMenu').classList.add('hidden');
});

emojiPicker.addEventListener('click', (e) => e.stopPropagation());

// Profile panel
document.getElementById('infoButton').addEventListener('click', () => {
  showProfile();
  pushNavigationState('profile-panel');
});

document.getElementById('backToChat')?.addEventListener('click', () => {
  closeProfile();
  if (navigationStack.length > 0 && navigationStack[navigationStack.length - 1] === 'profile-panel') {
    navigationStack.pop();
  }
});

document.getElementById('closeProfile').addEventListener('click', () => {
  closeProfile();
  if (navigationStack.length > 0 && navigationStack[navigationStack.length - 1] === 'profile-panel') {
    navigationStack.pop();
  }
});

// Back to chat list
document.getElementById('backToChatList').addEventListener('click', () => {
  showChatList();
  if (navigationStack.length > 0) {
    navigationStack.pop();
  }
});

// Close menus when clicking outside
document.addEventListener('click', () => {
  emojiPicker.classList.add('hidden');
  attachMenu.classList.add('hidden');
  document.getElementById('chatOptionsMenu').classList.add('hidden');
  chatContextMenu.classList.add('hidden');
});

// Context Menu functionality
const chatContextMenu = document.getElementById('chatContextMenu');
let contextMenuTargetId = null;

function showContextMenu(x, y, chatId) {
  contextMenuTargetId = chatId;
  chatContextMenu.classList.remove('hidden');
  
  chatContextMenu.style.left = `${x}px`;
  chatContextMenu.style.top = `${y}px`;
  
  const menuRect = chatContextMenu.getBoundingClientRect();
  const windowWidth = window.innerWidth;
  const windowHeight = window.innerHeight;
  
  if (menuRect.right > windowWidth) {
    chatContextMenu.style.left = `${windowWidth - menuRect.width - 10}px`;
  }
  if (menuRect.bottom > windowHeight) {
    chatContextMenu.style.top = `${windowHeight - menuRect.height - 10}px`;
  }
}

// Context menu actions
document.getElementById('contextMarkUnread')?.addEventListener('click', () => {
  const chat = allChats.find(c => c.id === contextMenuTargetId);
  if (chat) {
    chat.unread = chat.unread > 0 ? 0 : 1;
    renderChatList();
    updateUnreadCount();
  }
  chatContextMenu.classList.add('hidden');
});

document.getElementById('contextPinChat')?.addEventListener('click', () => {
  alert('Pin chat functionality would be implemented here');
  chatContextMenu.classList.add('hidden');
});

document.getElementById('contextArchive')?.addEventListener('click', () => {
  alert('Archive chat functionality would be implemented here');
  chatContextMenu.classList.add('hidden');
});

document.getElementById('contextClearChat')?.addEventListener('click', () => {
  const chat = allChats.find(c => c.id === contextMenuTargetId);
  if (chat && confirm(`Clear all messages with ${chat.name}?`)) {
    chat.messages = [];
    chat.lastMessage = 'No messages yet';
    renderChatList();
    if (activeChat.id === chat.id) {
      renderMessages();
    }
  }
  chatContextMenu.classList.add('hidden');
});

document.getElementById('contextDeleteChat')?.addEventListener('click', () => {
  const chat = allChats.find(c => c.id === contextMenuTargetId);
  if (chat && confirm(`Delete chat with ${chat.name}?`)) {
    allChats = allChats.filter(c => c.id !== contextMenuTargetId);
    filteredChats = [...allChats];
    if (activeChat.id === contextMenuTargetId && allChats.length > 0) {
      activeChat = allChats[0];
      renderActiveChat();
      renderMessages();
    }
    renderChatList();
    updateUnreadCount();
  }
  chatContextMenu.classList.add('hidden');
});

chatContextMenu.addEventListener('click', (e) => e.stopPropagation());

// Chat Options Menu
const chatOptionsButton = document.getElementById('chatOptionsButton');
const chatOptionsMenu = document.getElementById('chatOptionsMenu');
const newChatBtn = document.getElementById('newChatBtn');
const markAllReadBtn = document.getElementById('markAllReadBtn');
const settingsBtn = document.getElementById('settingsBtn');

chatOptionsButton.addEventListener('click', (e) => {
  e.stopPropagation();
  chatOptionsMenu.classList.toggle('hidden');
  emojiPicker.classList.add('hidden');
});

chatOptionsMenu.addEventListener('click', (e) => e.stopPropagation());

newChatBtn.addEventListener('click', () => {
  const newChatId = allChats.length > 0 ? Math.max(...allChats.map(c => c.id)) + 1 : 1;
  const newChat = {
    id: newChatId,
    name: "New Chat",
    role: "User",
    avatar: "https://lh3.googleusercontent.com/aida-public/AB6AXuBNMJHITvFDtpABr6FJ1SRH8WTYvRuc4Wg7EDI2Xmw29roT1HSDjbBEo56I6PMcAuzLAfqKcl97gqHY8HcaWTaO5WI_KXIVvU1eIwawidZYKQGNqImsW5m_GypbXknDBrihMbt4dtVgViEi6i-wZdRY9pvb8txUg68QWt9PZewmgcKafi15n5vro2TWuWqSmDz55mKNEKZPZwlqSrO2X-zj2qU9qDGxb83AaCeVDNpKHqik_kif1aViJ-AwnaAEDJ6KqYiNWTGwUIfk",
    lastMessage: "Start a new conversation...",
    time: "Now",
    unread: 0,
    online: true,
    bio: "New conversation",
    messages: []
  };
  allChats.unshift(newChat);
  activeChat = newChat;
  renderChatList();
  renderActiveChat();
  renderMessages();
  chatOptionsMenu.classList.add('hidden');
  showChatView();
  pushNavigationState('chat-view');
});

markAllReadBtn.addEventListener('click', () => {
  allChats.forEach(chat => chat.unread = 0);
  renderChatList();
  updateUnreadCount();
  chatOptionsMenu.classList.add('hidden');
});

settingsBtn.addEventListener('click', () => {
  alert('Settings panel would open here. This is a demo placeholder.');
  chatOptionsMenu.classList.add('hidden');
});

// Navigation state management
function pushNavigationState(state) {
  navigationStack.push(state);
  history.pushState({ navState: state }, '', window.location.href);
}

function handleBackNavigation() {
  if (navigationStack.length === 0) return;
  
  const currentState = navigationStack.pop();
  
  if (currentState === 'profile-panel') {
    closeProfile();
  } else if (currentState === 'chat-view') {
    showChatList();
  }
}

// Handle browser back button
window.addEventListener('popstate', (e) => {
  e.preventDefault();
  handleBackNavigation();
});

// Handle window resize
window.addEventListener('resize', () => {
  if (!isMobile()) {
    // Reset mobile classes when switching to desktop
    document.body.classList.remove('mobile-chat-open', 'mobile-profile-open');
  }
});

// Navigation button handlers
document.getElementById('navDMs')?.addEventListener('click', () => {
  // DM button works - show chat list
  showChatList();
});

document.getElementById('navHome')?.addEventListener('click', (e) => {
  e.preventDefault();
  // Do nothing - page not connected yet
});

document.getElementById('navExplore')?.addEventListener('click', (e) => {
  e.preventDefault();
  // Do nothing - page not connected yet
});

document.getElementById('navProfile')?.addEventListener('click', (e) => {
  e.preventDefault();
  // Do nothing - page not connected yet
});

// Initialize
history.pushState({ navState: 'initial' }, '', window.location.href);
renderChatList();
renderActiveChat();
renderMessages();
updateUnreadCount();
showChatList();
</script>

</body>
</html>
